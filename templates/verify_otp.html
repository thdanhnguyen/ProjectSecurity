{% extends "base.html" %}

{% block title %}X√°c Th·ª±c OTP - Secure Auth System{% endblock %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>X√°c Th·ª±c OTP</h1>
                <p>Nh·∫≠p m√£ OTP ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email <strong>{{ email }}</strong></p>
            </div>

            <form method="POST" action="{{ url_for('verify_otp') }}" class="auth-form">
                <div class="form-group">
                    <label for="otp">M√£ OTP (6 ch·ªØ s·ªë)</label>
                    <input type="text" id="otp" name="otp" required 
                           placeholder="000000" maxlength="6" pattern="[0-9]{6}"
                           class="otp-input" autofocus autocomplete="off">
                    <small class="form-hint">M√£ OTP c√≥ hi·ªáu l·ª±c trong 5 ph√∫t</small>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    X√°c Th·ª±c
                </button>
            </form>

            <div class="resend-section">
                <p>Kh√¥ng nh·∫≠n ƒë∆∞·ª£c m√£?</p>
                <button type="button" class="btn btn-outline" id="resendBtn" onclick="resendOTP()">
                    G·ª≠i L·∫°i OTP
                </button>
                <div id="resendTimer" class="resend-timer"></div>
            </div>

            <div class="auth-footer">
                <p><a href="{{ url_for('login') }}">‚Üê Quay l·∫°i ƒëƒÉng nh·∫≠p</a></p>
            </div>
        </div>

        <div class="auth-info">
            <h3>üìß Ki·ªÉm Tra Email</h3>
            <ul>
                <li>‚úì Ki·ªÉm tra h·ªôp th∆∞ ƒë·∫øn</li>
                <li>‚úì Ki·ªÉm tra th∆∞ m·ª•c spam</li>
                <li>‚úì M√£ OTP c√≥ 6 ch·ªØ s·ªë</li>
                <li>‚úì C√≥ hi·ªáu l·ª±c trong 5 ph√∫t</li>
            </ul>
        </div>
    </div>
</div>

<script>
let resendTimeout;
let countdown = 60;

function resendOTP() {
    const btn = document.getElementById('resendBtn');
    const timer = document.getElementById('resendTimer');
    
    btn.disabled = true;
    countdown = 60;
    
    fetch('{{ url_for("resend_otp") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showFlash('success', data.message);
            startCountdown();
        } else {
            showFlash('error', data.message);
            btn.disabled = false;
        }
    })
    .catch(error => {
        showFlash('error', 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i');
        btn.disabled = false;
    });
}

function startCountdown() {
    const btn = document.getElementById('resendBtn');
    const timer = document.getElementById('resendTimer');
    
    resendTimeout = setInterval(() => {
        countdown--;
        timer.textContent = `C√≥ th·ªÉ g·ª≠i l·∫°i sau ${countdown}s`;
        
        if (countdown <= 0) {
            clearInterval(resendTimeout);
            btn.disabled = false;
            timer.textContent = '';
        }
    }, 1000);
}

// Auto-format OTP input
document.getElementById('otp').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '');
});
</script>
{% endblock %}
